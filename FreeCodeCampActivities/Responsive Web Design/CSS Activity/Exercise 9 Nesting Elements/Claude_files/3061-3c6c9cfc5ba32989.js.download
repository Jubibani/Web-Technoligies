"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3061],{43061:function(e,t,n){n.d(t,{N6:function(){return getAuthUrl},Z1:function(){return useRecaptcha},_A:function(){return usePostAuthNav},c6:function(){return needsPhoneVerification},cG:function(){return needsAccountActionRedirect},nJ:function(){return useNavigateToDefaultRouteWithReturnTo},wJ:function(){return needsOnboarding},wy:function(){return useNavigateToDefaultRoute}});var r=n(93352),u=n(22809),i=n(32859),o=n(7653),a=n(83127);let needsOnboarding=e=>!(e.full_name&&e.display_name),needsPhoneVerification=e=>!(null==e?void 0:e.completed_verification_at),needsAccountActionRedirect=e=>needsOnboarding(e)||needsPhoneVerification(e),useDefaultLoggedInRoute=()=>{let{account:e}=(0,u.t)(),t=(0,r.Zx)(),{value:n}=(0,a.useGate)("console_workbench_enabled");return e&&needsOnboarding(e)?"/onboarding":e&&needsPhoneVerification(e)?"/verification":n&&!t?"/dashboard":"/chats"},usePostAuthNav=()=>{let{refetch:e}=(0,u.t)(),[t,n]=(0,o.useState)(!1),[r,i]=(0,o.useState)(!1),a=useNavigateToDefaultRouteWithReturnTo();return(0,o.useEffect)(()=>{t&&r&&a()},[r,a,t]),(0,o.useCallback)(async()=>{n(!0),await e(),i(!0)},[e])},useNavigateToDefaultRouteWithReturnTo=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=(0,i.useSearchParams)(),n=t.get("returnTo"),r=useNavigateToDefaultRoute(e);return(0,o.useCallback)(()=>{r(n)},[r,n])},useNavigateToDefaultRoute=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],{account:t,isLoading:n}=(0,u.t)(),[r,a]=(0,o.useState)(!1),c=(0,i.useRouter)(),[s,l]=(0,o.useState)(null),d=useDefaultLoggedInRoute();return(r||e)&&!n&&!t&&c.push(getAuthUrl()),(0,o.useEffect)(()=>{if(r&&t){let e=getPostAuthRedirectUrl(t,s,d);c.push(e)}},[t,c,r,s,d]),(0,o.useCallback)(e=>{e&&l(e),a(!0)},[])},getPostAuthRedirectUrl=(e,t,n)=>{let r;if(!t||!t.startsWith("/"))return n;try{r=new URL("".concat(window.location.origin).concat(t))}catch(e){return n}if(needsAccountActionRedirect(e)){let e=new URLSearchParams({returnTo:t});return"".concat(n,"?").concat(e.toString())}return r.href},getAuthUrl=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/login",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new URLSearchParams(t),r=window.location.pathname+window.location.search;return n.append("returnTo",r),"".concat(e,"?").concat(n.toString())};function useRecaptcha(){let[e,t]=(0,o.useState)(!1),n=(0,o.useCallback)(async(e,n)=>(t(!0),new Promise((r,u)=>{if("undefined"==typeof grecaptcha)return t(!1),u(Error("Recaptcha failed to load"));grecaptcha.enterprise.ready(()=>{grecaptcha.enterprise.execute(e,{action:n}).then(e=>{r(e),t(!1)},e=>{t(!1),u(e)})})})),[]);return{getRecaptchaToken:n,isLoading:e}}},86211:function(e,t,n){n.d(t,{Ne:function(){return useOptimisticApiMutation},WE:function(){return useApiQuery},uC:function(){return useApiMutation}});var r=n(38348),u=n(39547),i=n(40604),o=n(61501),a=n(10040),c=n(7653),s=n(72623);function useFetch(e){let{setUpdateType:t}=(0,s.m)();return(0,c.useCallback)(async(n,i)=>{let o=await fetch(n,{...i,headers:{"anthropic-client-sha":"405ee5562c871142f58392b80c90597a313e5487","anthropic-client-version":"1",...i.headers}}),a=o.headers.get("anthropic-client-update");a&&["prompt","force"].includes(a)&&t(a);let c=await o.text(),s={error:{type:"api_error",message:c}};try{("DELETE"!==i.method||c.length>0)&&(s=JSON.parse(c))}catch(e){(0,u.uT)("Got invalid JSON from NextJS response",{extra:{text:c,status:o.status}})}if(!o.ok)throw(0,r.fT)(o.status,s,e);return s},[e,t])}let useApiMutation=(e,t,n)=>{let{transformVariables:r,enabled:u=!0,...o}=n||{},a=useFetch("Mutation error"),{mutate:s,...l}=(0,i.useMutation)({mutationFn:async n=>{let u;u="function"==typeof e?e(n):e;let i=r?r(n):n,o=await a(u,{method:t,headers:{"Content-Type":"application/json"},body:i?JSON.stringify(i):void 0});return o},...o}),d=(0,c.useCallback)(e=>{u&&s(e)},[s,u]);return{mutate:d,...l}},useApiQuery=(e,t)=>{let n=useFetch("Query error");return(0,o.useQuery)({queryKey:[e],queryFn:async()=>{let t=await n(e,{method:"GET",headers:{"Content-Type":"application/json"}});return t},retry:!1,...t})};function useOptimisticApiMutation(e,t,n,r){let u=(0,a.useQueryClient)(),{queryKey:i,...o}=r;return useApiMutation(e,t,{async onMutate(e){await u.cancelQueries({queryKey:i});let t=u.getQueryData(i);return u.setQueryData(i,t=>n(e,t)),{previousValue:t}},onError(e,t,n){(null==n?void 0:n.previousValue)&&u.setQueryData(i,n.previousValue)},...o})}},72623:function(e,t,n){n.d(t,{F:function(){return ClientUpdateProvider},m:function(){return useClientUpdate}});var r=n(27573),u=n(71036),i=n(7653);let o=(0,i.createContext)(null),a="undefined"!=typeof navigator&&"serviceWorker"in navigator,getWorkbox=()=>"workbox"in window&&a?window.workbox:null,updateWorkbox=e=>{let run=async()=>{try{await e.update()}catch(e){}};run()};function ClientUpdateProvider(e){let{children:t}=e,[n,c]=(0,i.useState)(null);(0,i.useEffect)(()=>{(0,u.yG)()&&a&&(async()=>{let e=await navigator.serviceWorker.getRegistrations();0!==e.length&&(console.warn("Found ".concat(e.length," service worker(s). This was probably from running a production build at this origin. Unregistering.")),e.forEach(e=>void e.unregister()))})()},[]),(0,i.useEffect)(()=>{let e=getWorkbox();e&&n&&((async()=>{let e=await window.caches.keys();await Promise.all(e.map(e=>caches.delete(e)))})(),updateWorkbox(e))},[n]),(0,i.useEffect)(()=>{let e=getWorkbox();if(!e)return;let t=window.setInterval(()=>{updateWorkbox(e)},36e5);return()=>{window.clearInterval(t)}},[]);let s=(0,i.useMemo)(()=>({updateType:n,setUpdateType:c}),[n]);return(0,r.jsx)(o.Provider,{value:s,children:t})}function useClientUpdate(){let e=(0,i.useContext)(o);if(!e)throw Error("Must be called from within ClientUpdateProvider");return e}},93352:function(e,t,n){n.d(t,{Pc:function(){return ConfigurationProvider},Zx:function(){return useIsClaudeDot},mX:function(){return useConfiguration}});var r=n(27573),u=n(7653);let i=(0,u.createContext)(void 0),ConfigurationProvider=e=>{let{config:t,children:n}=e;return(0,r.jsx)(i.Provider,{value:t,children:n})},useConfiguration=()=>{let e=(0,u.useContext)(i);if(!e)throw Error("useConfiguration must be called from within ConfigurationProvider");return e},useIsClaudeDot=()=>{let{applicationType:e}=useConfiguration();return"claude-dot"===e}},22809:function(e,t,n){n.d(t,{IU:function(){return useUsagePaused},Q6:function(){return CurrentAccountProvider},ZJ:function(){return useHasProSubscription},oD:function(){return useCurrentAccountQuery},t:function(){return useCurrentAccount}});var r=n(27573),u=n(71036),i=n(99865),o=n(39547),a=n(44637),c=n.n(a),s=n(32859),l=n(7653),d=n(58372),f=n(86211),p=n(93352),h=n(19981);let g="lastActiveOrg",v=(0,l.createContext)(null),CurrentAccountProvider=e=>{let{children:t}=e,[n,i]=(0,l.useState)(),{data:a,isFetching:f,refetch:m}=useCurrentAccountQuery(),w=(0,h.K)();(0,l.useEffect)(()=>{if(!(null==a?void 0:a.success))return;let e=a.account;o.av({id:e.uuid});let t="none";for(let n of["commercial_use","claude_pro","api"])if(e.memberships.some(e=>e.organization.capabilities.includes(n))){t="commercial_use";break}w.identify(a.account.uuid,{plan:t})},[a,w]);let b=(0,s.usePathname)();(0,l.useEffect)(()=>{!(0,u.yG)()&&(null==a?void 0:a.success)&&b&&w.page(b)},[b,w,a]),(0,l.useEffect)(()=>{if(n)try{window.localStorage.setItem(g,n)}catch(e){}},[n]);let y=(0,d.o)();(0,l.useEffect)(()=>{!(0,u.yG)()&&(null==a?void 0:a.success)&&y.boot({hideDefaultLauncher:!0,userId:a.account.uuid,email:a.account.email_address,name:a.account.full_name,userHash:a.intercomAccountHash})},[y,a]);let _=(0,p.Zx)(),C=(0,s.useSearchParams)(),A=C.get("organization_id"),P=(0,l.useMemo)(()=>{let e;if(!(null==a?void 0:a.success))return;let t=_?"chat":"api",r=a.account.memberships.map(e=>e.organization).filter(e=>e.capabilities.includes(t));if(n){let e=r.find(e=>e.uuid===n);if(e)return e}if(A&&(e=r.find(e=>e.uuid===A)),!e)try{let t=window.localStorage.getItem(g);e=r.find(e=>e.uuid===t)}catch(e){}return e||(e=c()(r,"name")),e&&i(e.uuid),e},[a,n,A,_]);(0,l.useEffect)(()=>{P&&y.update({customAttributes:{paidAccount:P.capabilities.includes("commercial_use"),claudePro:P.capabilities.includes("claude_pro"),orgUUID:P.uuid,orgName:P.name,orgCapabilities:P.capabilities.join(",")}})},[y,P]);let k=(0,l.useMemo)(()=>({account:(null==a?void 0:a.success)?a.account:void 0,messageLimit:(null==a?void 0:a.success)&&P?a.messageLimits[P.uuid]:void 0,activeOrganization:P,setActiveOrganizationUUID:i,isLoading:f,isLoggedOut:!f&&(null==a?void 0:a.success)===!1,refetch:async()=>{var e;let t=await m();if(null===(e=t.data)||void 0===e?void 0:e.success)return t.data.account}}),[a,P,f,m]);return(0,r.jsx)(v.Provider,{value:k,children:t})},useCurrentAccountQuery=()=>(0,f.WE)("/api/auth/current_account",{queryKey:[i.aY],staleTime:1/0}),useCurrentAccount=()=>{let e=(0,l.useContext)(v);if(!e)throw Error("Must call inside CurrentAccountProvider");return e},useHasProSubscription=()=>{let{activeOrganization:e}=useCurrentAccount();return null==e?void 0:e.capabilities.includes("claude_pro")},useUsagePaused=()=>{let{activeOrganization:e}=useCurrentAccount();return null!=e&&!!e.billable_usage_paused_until&&new Date(e.billable_usage_paused_until)>new Date}},19981:function(e,t,n){n.d(t,{K:function(){return useSegment}});var r=n(27376),u=n(93352);let i=null,useSegment=()=>{let{segmentKey:e,segmentCdnHost:t,segmentApiHost:n}=(0,u.mX)();return i||(i=r.b.load({writeKey:e,cdnURL:"https://".concat(t)},{disableClientPersistence:!0,integrations:{"Segment.io":{apiHost:"".concat(n,"/v1"),protocol:"https"}}})),i}},38348:function(e,t,n){n.d(t,{Hx:function(){return APIError},fT:function(){return errorFromResponse}});let APIError=class APIError extends Error{constructor(e,t,n,r){super(e),this.type=t,this.statusCode=n,this.extra=r}};function errorFromResponse(e,t,n){if(t&&"object"==typeof t&&"error"in t){let n=t.error,{message:r,type:u,...i}=n;return new APIError(r,u,e,i)}return new APIError(n,"api_error",e,t||{})}},71036:function(e,t,n){n.d(t,{yG:function(){return isDevelopment}}),n(68571);let isDevelopment=()=>!1},99865:function(e,t,n){n.d(t,{BB:function(){return a},I_:function(){return o},L0:function(){return g},QU:function(){return d},RK:function(){return f},aY:function(){return u},dv:function(){return h},eW:function(){return l},mm:function(){return i},nM:function(){return r},ph:function(){return s},tv:function(){return c},xp:function(){return p}});let r="api_key_list",u="current_account",i="org",o="org_members",a="org_invites",c="chat_conversation_list",s="chat_conversation",l="account_statsig",d="subscription_details",f="invoice_list",p="workbench_list_prompts",h="workbench_get_prompt",g="workbench_list_revisions"}}]);