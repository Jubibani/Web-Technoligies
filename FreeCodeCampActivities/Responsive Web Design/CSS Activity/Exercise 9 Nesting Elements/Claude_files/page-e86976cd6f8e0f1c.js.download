(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2586,2253],{10572:function(e){e.exports=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}},47392:function(e,t,n){var a=n(11496),u=n(17166)(a);e.exports=u},20231:function(e,t,n){var a=n(62849),u=n(81946);e.exports=function baseFlatten(e,t,n,i,l){var o=-1,s=e.length;for(n||(n=u),l||(l=[]);++o<s;){var f=e[o];t>0&&n(f)?t>1?baseFlatten(f,t-1,n,i,l):a(l,f):i||(l[l.length]=f)}return l}},4263:function(e,t,n){var a=n(14820)();e.exports=a},11496:function(e,t,n){var a=n(4263),u=n(22901);e.exports=function(e,t){return e&&a(e,t,u)}},97490:function(e,t,n){var a=n(47392),u=n(97703);e.exports=function(e,t){var n=-1,i=u(e)?Array(e.length):[];return a(e,function(e,a,u){i[++n]=t(e,a,u)}),i}},60455:function(e,t,n){var a=n(45667),u=n(26402),i=n(89308),l=n(97490),o=n(4779),s=n(74238),f=n(91816),d=n(39276),p=n(54703);e.exports=function(e,t,n){t=t.length?a(t,function(e){return p(e)?function(t){return u(t,1===e.length?e[0]:e)}:e}):[d];var g=-1;return t=a(t,s(i)),o(l(e,function(e,n,u){return{criteria:a(t,function(t){return t(e)}),index:++g,value:e}}),function(e,t){return f(e,t,n)})}},19952:function(e,t,n){var a=n(39276),u=n(84776),i=n(96684);e.exports=function(e,t){return i(u(e,t,a),e+"")}},40438:function(e,t,n){var a=n(82961),u=n(12808),i=n(39276),l=u?function(e,t){return u(e,"toString",{configurable:!0,enumerable:!1,value:a(t),writable:!0})}:i;e.exports=l},4779:function(e){e.exports=function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}},27125:function(e,t,n){var a=n(36883);e.exports=function(e,t){if(e!==t){var n=void 0!==e,u=null===e,i=e==e,l=a(e),o=void 0!==t,s=null===t,f=t==t,d=a(t);if(!s&&!d&&!l&&e>t||l&&o&&f&&!s&&!d||u&&o&&f||!n&&f||!i)return 1;if(!u&&!l&&!d&&e<t||d&&n&&i&&!u&&!l||s&&n&&i||!o&&i||!f)return -1}return 0}},91816:function(e,t,n){var a=n(27125);e.exports=function(e,t,n){for(var u=-1,i=e.criteria,l=t.criteria,o=i.length,s=n.length;++u<o;){var f=a(i[u],l[u]);if(f){if(u>=s)return f;return f*("desc"==n[u]?-1:1)}}return e.index-t.index}},17166:function(e,t,n){var a=n(97703);e.exports=function(e,t){return function(n,u){if(null==n)return n;if(!a(n))return e(n,u);for(var i=n.length,l=t?i:-1,o=Object(n);(t?l--:++l<i)&&!1!==u(o[l],l,o););return n}}},14820:function(e){e.exports=function(e){return function(t,n,a){for(var u=-1,i=Object(t),l=a(t),o=l.length;o--;){var s=l[e?o:++u];if(!1===n(i[s],s,i))break}return t}}},12808:function(e,t,n){var a=n(54070),u=function(){try{var e=a(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=u},81946:function(e,t,n){var a=n(37515),u=n(84502),i=n(54703),l=a?a.isConcatSpreadable:void 0;e.exports=function(e){return i(e)||u(e)||!!(l&&e&&e[l])}},12841:function(e,t,n){var a=n(41233),u=n(97703),i=n(21497),l=n(41548);e.exports=function(e,t,n){if(!l(n))return!1;var o=typeof t;return("number"==o?!!(u(n)&&i(t,n.length)):"string"==o&&t in n)&&a(n[t],e)}},84776:function(e,t,n){var a=n(10572),u=Math.max;e.exports=function(e,t,n){return t=u(void 0===t?e.length-1:t,0),function(){for(var i=arguments,l=-1,o=u(i.length-t,0),s=Array(o);++l<o;)s[l]=i[t+l];l=-1;for(var f=Array(t+1);++l<t;)f[l]=i[l];return f[t]=n(s),a(e,this,f)}}},96684:function(e,t,n){var a=n(40438),u=n(79699)(a);e.exports=u},79699:function(e){var t=Date.now;e.exports=function(e){var n=0,a=0;return function(){var u=t(),i=16-(u-a);if(a=u,i>0){if(++n>=800)return arguments[0]}else n=0;return e.apply(void 0,arguments)}}},82961:function(e){e.exports=function(e){return function(){return e}}},64677:function(e,t,n){var a=n(20231),u=n(60455),i=n(19952),l=n(12841),o=i(function(e,t){if(null==e)return[];var n=t.length;return n>1&&l(e,t[0],t[1])?t=[]:n>2&&l(t[0],t[1],t[2])&&(t=[t[0]]),u(e,a(t,1),[])});e.exports=o},80313:function(e,t,n){Promise.resolve().then(n.bind(n,31108))},31108:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Page}});var a=n(27573),u=n(80028),i=n(32859),l=n(90274),o=n(22809),s=n(61927),f=n(69507),d=n(7653),p=n(85479),g=n(94786),h=n(93352),v=n(30773),b=n(99865),y=n(10040),x=n(78104),E=n.n(x),M=n(83127),S=n(87055),Z=n(2024),O=n(86056),C=n(74134);function PersistedChat(e){var t,n;let{conversationUUID:x,isFirstChat:j,chatInputDefaultMessage:F}=e,{activeOrganization:_}=(0,o.t)(),[w,P]=(0,d.useState)("basic"),A=(0,y.useQueryClient)(),D=(0,h.Zx)(),{onIncrementalCompletion:T}=(0,g.g)(),{value:U}=(0,M.useGate)("direct_completion_endpoint"),I=(0,p.ZP)({conversationUUID:x,endpoint:U?l.Cb.STREAM_COMPLETION:l.Cb.STREAM_COMPLETION_NEXTJS,onIncrementalCompletion:T}),N=(0,p.TQ)(x),R=(0,p.DM)(x),{data:k,isLoading:L}=(0,u.hA)(x,{suppressError:!0}),[Q,H]=function(e){let{data:t}=(0,u.QR)(),[n,a]=(0,d.useState)(),[i,l]=(0,d.useState)(!1),{activeOrganization:p}=(0,o.t)(),g=e?e.uuid:"",{mutate:h}=(0,u.W)(g),{mutate:v}=(0,u.j7)();(0,s.Z)(()=>{void 0!==n&&p&&e&&e.name!==n&&h({name:n})},[n,p,e],500);let b=null!=n?n:null==e?void 0:e.name;return(0,d.useEffect)(()=>{if(i||b)return;let n=null==e?void 0:e.chat_messages;if(!n||0===n.length)return;let a=(0,f.HM)({attachments:n[0].attachments,blurbOnly:!0,useLegacyFormat:!0}),u=[...a,(0,f.iy)(n[0].text)].join("\n\n"),o=null==t?void 0:t.filter(t=>t.uuid!==e.uuid).map(e=>e.name).slice(0,10);if(!o)return;let s=o.filter((e,t)=>o.indexOf(e)===t);p&&(l(!0),v({organization_uuid:p.uuid,conversation_uuid:e.uuid,message_content:u,recent_titles:s}))},[b,i,e,p,t,v]),[null!=b?b:"Untited Chat",a]}(k),{mutate:V}=(0,u.lG)(x),onRetry=async()=>{let e=[b.ph,{orgUUID:null==_?void 0:_.uuid},{uuid:x}];A.setQueryData(e,e=>{if(!e)return;let t=e.chat_messages,n=E()(t,"index");return(null==n?void 0:n.sender)==="assistant"&&(t=t.map(e=>e.index===n.index?{...e,text:""}:e)),{...e,chat_messages:t}}),A.setQueryDefaults(e,{staleTime:1/0});try{await R.runStream()}finally{A.setQueryDefaults(e,{staleTime:0})}};if(!k){if(L)return(0,a.jsx)("div",{className:"fixed inset-0 grid place-items-center",children:(0,a.jsx)(v.Z,{})});(0,i.notFound)()}let G=I.isStreaming||N.isStreaming||R.isStreaming;return D?(0,a.jsx)(S.Z,{abortStream:N.abortStream,isFirstChat:j,isStreaming:I.isStreaming||N.isStreaming||R.isStreaming,sentMessageTokenCount:I.sentMessageTokenCount,chatInputDefaultMessage:F,mode:w,setMode:P,conversationUUID:x,messages:k.chat_messages,name:null!==(n=null!=Q?Q:k.name)&&void 0!==n?n:"Untitled Chat",setName:H,onSend:N.runStream,onRetry:onRetry}):(0,a.jsx)(C.Z,{isFirstChat:j,isStreaming:G,messages:k.chat_messages,mode:w,setMode:P,name:null!==(t=null!=Q?Q:k.name)&&void 0!==t?t:"Untitled Chat",setName:H,children:"basic"===w?(0,a.jsx)(O.Z,{abortStream:N.abortStream,conversationUUID:x,isFirstChat:j,isStreaming:G,messages:k.chat_messages,onRetry:onRetry,onSend:N.runStream,chatInputDefaultMessage:F,sentMessageTokenCount:I.sentMessageTokenCount}):(0,a.jsx)(Z.Z,{isFirstChat:j,isStreaming:G,messages:k.chat_messages,runStream:I.runStream,updateMessages:V})})}function Page(e){let{params:{uuid:t}}=e,n=(0,i.useSearchParams)(),l=null==n?void 0:n.get("q"),{data:o}=(0,u.QR)();return(0,a.jsx)(PersistedChat,{isFirstChat:1>=((null==o?void 0:o.length)||0),conversationUUID:t,chatInputDefaultMessage:null!=l?l:void 0})}},41682:function(e,t,n){"use strict";n.d(t,{Z:function(){return g}});var a=n(7653),u=n(12778),i=Object.defineProperty,l=Object.defineProperties,o=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,f=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable,r=(e,t,n)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,m=(e,t)=>{for(var n in t||(t={}))f.call(t,n)&&r(e,n,t[n]);if(s)for(var n of s(t))d.call(t,n)&&r(e,n,t[n]);return e},c=(e,t)=>l(e,o(t));let p=new Map([["bold",a.createElement(a.Fragment,null,a.createElement("path",{d:"M232.49,80.49l-128,128a12,12,0,0,1-17,0l-56-56a12,12,0,1,1,17-17L96,183,215.51,63.51a12,12,0,0,1,17,17Z"}))],["duotone",a.createElement(a.Fragment,null,a.createElement("path",{d:"M232,56V200a16,16,0,0,1-16,16H40a16,16,0,0,1-16-16V56A16,16,0,0,1,40,40H216A16,16,0,0,1,232,56Z",opacity:"0.2"}),a.createElement("path",{d:"M205.66,85.66l-96,96a8,8,0,0,1-11.32,0l-40-40a8,8,0,0,1,11.32-11.32L104,164.69l90.34-90.35a8,8,0,0,1,11.32,11.32Z"}))],["fill",a.createElement(a.Fragment,null,a.createElement("path",{d:"M216,40H40A16,16,0,0,0,24,56V200a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40ZM205.66,85.66l-96,96a8,8,0,0,1-11.32,0l-40-40a8,8,0,0,1,11.32-11.32L104,164.69l90.34-90.35a8,8,0,0,1,11.32,11.32Z"}))],["light",a.createElement(a.Fragment,null,a.createElement("path",{d:"M228.24,76.24l-128,128a6,6,0,0,1-8.48,0l-56-56a6,6,0,0,1,8.48-8.48L96,191.51,219.76,67.76a6,6,0,0,1,8.48,8.48Z"}))],["regular",a.createElement(a.Fragment,null,a.createElement("path",{d:"M229.66,77.66l-128,128a8,8,0,0,1-11.32,0l-56-56a8,8,0,0,1,11.32-11.32L96,188.69,218.34,66.34a8,8,0,0,1,11.32,11.32Z"}))],["thin",a.createElement(a.Fragment,null,a.createElement("path",{d:"M226.83,74.83l-128,128a4,4,0,0,1-5.66,0l-56-56a4,4,0,0,1,5.66-5.66L96,194.34,221.17,69.17a4,4,0,1,1,5.66,5.66Z"}))]]),g=(0,a.forwardRef)((e,t)=>a.createElement(u.Z,c(m({ref:t},e),{weights:p})));g.displayName="Check"},33607:function(e,t,n){"use strict";n.d(t,{Z:function(){return g}});var a=n(7653),u=n(12778),i=Object.defineProperty,l=Object.defineProperties,o=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,f=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable,r=(e,t,n)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,c=(e,t)=>{for(var n in t||(t={}))f.call(t,n)&&r(e,n,t[n]);if(s)for(var n of s(t))d.call(t,n)&&r(e,n,t[n]);return e},m=(e,t)=>l(e,o(t));let p=new Map([["bold",a.createElement(a.Fragment,null,a.createElement("path",{d:"M234.38,210a123.36,123.36,0,0,0-60.78-53.23,76,76,0,1,0-91.2,0A123.36,123.36,0,0,0,21.62,210a12,12,0,1,0,20.77,12c18.12-31.32,50.12-50,85.61-50s67.49,18.69,85.61,50a12,12,0,0,0,20.77-12ZM76,96a52,52,0,1,1,52,52A52.06,52.06,0,0,1,76,96Z"}))],["duotone",a.createElement(a.Fragment,null,a.createElement("path",{d:"M192,96a64,64,0,1,1-64-64A64,64,0,0,1,192,96Z",opacity:"0.2"}),a.createElement("path",{d:"M230.92,212c-15.23-26.33-38.7-45.21-66.09-54.16a72,72,0,1,0-73.66,0C63.78,166.78,40.31,185.66,25.08,212a8,8,0,1,0,13.85,8c18.84-32.56,52.14-52,89.07-52s70.23,19.44,89.07,52a8,8,0,1,0,13.85-8ZM72,96a56,56,0,1,1,56,56A56.06,56.06,0,0,1,72,96Z"}))],["fill",a.createElement(a.Fragment,null,a.createElement("path",{d:"M230.93,220a8,8,0,0,1-6.93,4H32a8,8,0,0,1-6.92-12c15.23-26.33,38.7-45.21,66.09-54.16a72,72,0,1,1,73.66,0c27.39,8.95,50.86,27.83,66.09,54.16A8,8,0,0,1,230.93,220Z"}))],["light",a.createElement(a.Fragment,null,a.createElement("path",{d:"M229.19,213c-15.81-27.32-40.63-46.49-69.47-54.62a70,70,0,1,0-63.44,0C67.44,166.5,42.62,185.67,26.81,213a6,6,0,1,0,10.38,6C56.4,185.81,90.34,166,128,166s71.6,19.81,90.81,53a6,6,0,1,0,10.38-6ZM70,96a58,58,0,1,1,58,58A58.07,58.07,0,0,1,70,96Z"}))],["regular",a.createElement(a.Fragment,null,a.createElement("path",{d:"M230.92,212c-15.23-26.33-38.7-45.21-66.09-54.16a72,72,0,1,0-73.66,0C63.78,166.78,40.31,185.66,25.08,212a8,8,0,1,0,13.85,8c18.84-32.56,52.14-52,89.07-52s70.23,19.44,89.07,52a8,8,0,1,0,13.85-8ZM72,96a56,56,0,1,1,56,56A56.06,56.06,0,0,1,72,96Z"}))],["thin",a.createElement(a.Fragment,null,a.createElement("path",{d:"M227.46,214c-16.52-28.56-43-48.06-73.68-55.09a68,68,0,1,0-51.56,0c-30.64,7-57.16,26.53-73.68,55.09a4,4,0,0,0,6.92,4C55,184.19,89.62,164,128,164s73,20.19,92.54,54a4,4,0,0,0,3.46,2,3.93,3.93,0,0,0,2-.54A4,4,0,0,0,227.46,214ZM68,96a60,60,0,1,1,60,60A60.07,60.07,0,0,1,68,96Z"}))]]),g=(0,a.forwardRef)((e,t)=>a.createElement(u.Z,m(c({ref:t},e),{weights:p})));g.displayName="User"}},function(e){e.O(0,[2044,7611,4454,6378,1550,3127,2056,9711,4637,4103,3078,8935,6072,1328,5989,8609,484,9079,159,2135,5839,2864,5426,6841,5479,9217,2506,7055,5791,1293,1362,3216,1744],function(){return e(e.s=80313)}),_N_E=e.O()}]);